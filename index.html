<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardware Configuration Tool</title>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Samsung Sharp Sans"', '"Noto Sans KR"', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="./src/style.css">

    <!-- Libraries (CDN) -->
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>

<body
    class="bg-slate-50 h-screen flex flex-col overflow-hidden text-slate-800 antialiased selection:bg-slate-200 selection:text-slate-900 fade-in">

    <!-- Navigation -->
    <nav
        class="fixed w-full bg-white/80 backdrop-blur-sm z-50 border-b border-slate-100 h-16 flex items-center justify-between px-6">
        <div class="flex items-center gap-6">
            <a href="#" class="text-lg font-bold tracking-tight text-slate-900 flex items-center gap-2">
                <i data-lucide="box" class="w-5 h-5"></i>
                HARDWARE.CONFIG
                <span id="app-version" class="text-xs font-normal text-slate-500 ml-1"></span>
            </a>

        </div>

        <div class="flex items-center gap-4">
            <!-- View Switcher -->
            <div class="flex bg-slate-100 rounded-lg p-1 gap-1">
                <button id="btn-view-logical"
                    class="px-4 py-1.5 text-sm rounded-md bg-white shadow-sm text-slate-900 font-medium transition-all flex items-center gap-2">
                    <i data-lucide="network" class="w-4 h-4"></i>
                    Configuration
                </button>
                <button id="btn-view-physical"
                    class="px-4 py-1.5 text-sm rounded-md text-slate-500 hover:text-slate-900 transition-all flex items-center gap-2">
                    <i data-lucide="layout" class="w-4 h-4"></i>
                    Installation
                </button>
                <button id="btn-view-network"
                    class="px-4 py-1.5 text-sm rounded-md text-slate-500 hover:text-slate-900 transition-all flex items-center gap-2">
                    <i data-lucide="server" class="w-4 h-4"></i>
                    Network
                </button>
                <button id="btn-hardware-list"
                    class="px-4 py-1.5 text-sm rounded-md text-slate-500 hover:text-slate-900 transition-all flex items-center gap-2">
                    <i data-lucide="list" class="w-4 h-4"></i>
                    Hardware List
                </button>
            </div>

            <!-- Project File Buttons -->
            <div class="flex items-center gap-2">
                <input type="file" id="input-import-project" accept=".cdt,.json" class="hidden">
                
                <!-- Save Button with Dropdown -->
                <div class="relative">
                    <button id="btn-save"
                        class="px-4 py-1.5 text-sm rounded-md bg-slate-100 text-slate-700 hover:bg-slate-200 transition-all flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Save
                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                    <div id="save-dropdown" class="hidden absolute top-full left-0 mt-1 bg-white rounded-md shadow-lg border border-slate-200 py-1 min-w-[120px] z-50">
                        <button id="btn-save-local"
                            class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center gap-2">
                            <i data-lucide="hard-drive" class="w-4 h-4"></i>
                            Local
                        </button>
                        <button id="btn-save-nas"
                            class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center gap-2">
                            <i data-lucide="server" class="w-4 h-4"></i>
                            NAS
                        </button>
                    </div>
                </div>

                <!-- Load Button with Dropdown -->
                <div class="relative">
                    <button id="btn-load"
                        class="px-4 py-1.5 text-sm rounded-md bg-slate-100 text-slate-700 hover:bg-slate-200 transition-all flex items-center gap-2">
                        <i data-lucide="folder-open" class="w-4 h-4"></i>
                        Load
                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                    <div id="load-dropdown" class="hidden absolute top-full left-0 mt-1 bg-white rounded-md shadow-lg border border-slate-200 py-1 min-w-[120px] z-50">
                        <button id="btn-load-local"
                            class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center gap-2">
                            <i data-lucide="hard-drive" class="w-4 h-4"></i>
                            Local
                        </button>
                        <button id="btn-load-nas"
                            class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center gap-2">
                            <i data-lucide="server" class="w-4 h-4"></i>
                            NAS
                        </button>
                    </div>
                </div>

                <button id="btn-clear-project"
                    class="px-4 py-1.5 text-sm rounded-md bg-red-100 text-red-700 hover:bg-red-200 transition-all flex items-center gap-2">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                    Clear
                </button>
            </div>

            <!-- Export PPT Button (Separated) -->
            <button id="btn-export-ppt"
                class="px-4 py-1.5 text-sm rounded-md bg-slate-900 text-white hover:bg-slate-800 transition-all flex items-center gap-2 shadow-sm">
                <i data-lucide="presentation" class="w-4 h-4"></i>
                Export PPT
            </button>

            <div class="w-px h-6 bg-slate-200 mx-2"></div>


        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 relative flex pt-16 overflow-hidden min-h-0">
        <!-- Sidebar (BOM / Tools) -->
        <aside
            class="w-72 bg-white border-r border-slate-100 flex flex-col shrink-0 z-40 shadow-sm h-full overflow-hidden">
            <!-- Header Removed -->
            <div class="flex-1 overflow-y-auto p-6 min-h-0 custom-scrollbar">
                <!-- Node Palette Removed: Using Hardware List instead -->

                <!-- Instructions Card -->
                <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                    <h3 class="text-xs font-bold text-slate-900 mb-2 flex items-center gap-2">
                        <i data-lucide="info" class="w-3 h-3"></i> Guide
                    </h3>
                    <p class="text-xs text-slate-500 leading-relaxed">
                        Drag components to the canvas.<br>
                        Switch to <strong>Physical</strong> view to arrange on floor plan.<br>
                        Use <strong>Request</strong> mode to add markers.
                    </p>
                </div>

                <!-- Hardware Registry Section -->
                <div class="mt-8 border-t border-slate-100 pt-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-bold text-slate-900 text-sm uppercase tracking-wider flex items-center gap-2">
                            <i data-lucide="list" class="w-4 h-4 text-slate-400"></i>
                            Hardware List
                        </h2>
                        <button id="btn-add-hardware"
                            class="text-xs bg-slate-900 text-white px-2 py-1 rounded hover:bg-slate-700 transition-colors">
                            + Add
                        </button>
                    </div>
                    <div id="hardware-list-container" class="space-y-2">
                        <!-- Hardware items will be added here -->
                        <p class="text-xs text-slate-400 italic text-center py-2">No hardware defined.</p>
                    </div>
                </div>

                <!-- Properties Panel (Hidden by default) -->
                <div id="properties-panel" class="hidden mt-8 border-t border-slate-100 pt-6">
                    <h2 class="font-bold text-slate-900 text-sm uppercase tracking-wider flex items-center gap-2 mb-4">
                        <i data-lucide="settings" class="w-4 h-4 text-slate-400"></i>
                        Properties
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">Type</label>
                            <input type="text" id="prop-type"
                                class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-500"
                                disabled>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">Name / ID</label>
                            <input type="text" id="prop-id"
                                class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-900 focus:outline-none focus:border-slate-400 transition-colors">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">Model</label>
                            <input type="text" id="prop-model"
                                class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-900 focus:outline-none focus:border-slate-400 transition-colors"
                                placeholder="e.g. CISCO-2960">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">IP Address</label>
                            <input type="text" id="prop-ip"
                                class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-900 focus:outline-none focus:border-slate-400 transition-colors"
                                placeholder="192.168.1.1">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-500 mb-1">Description</label>
                            <textarea id="prop-desc" rows="3"
                                class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-900 focus:outline-none focus:border-slate-400 transition-colors resize-none"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Canvas Area -->
        <!-- Canvas Area -->
        <div class="flex-1 bg-slate-50 relative overflow-hidden flex">
            <!-- Action Buttons Group - Positioned at top left -->
            <div class="absolute top-4 left-4 z-50 flex items-center gap-2">
                <button id="btn-sync-config"
                    class="bg-white text-slate-600 border border-slate-200 hover:border-slate-300 hover:text-slate-900 px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 shadow-sm hidden">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    Sync from Configuration
                </button>
                <button id="btn-upload-plan"
                    class="bg-white text-slate-600 border border-slate-200 hover:border-slate-300 hover:text-slate-900 px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 shadow-sm hidden">
                    <i data-lucide="upload" class="w-4 h-4"></i>
                    Upload Plan
                </button>
            </div>

            <div class="flex-1 relative overflow-hidden flex flex-col items-center justify-center p-4"
                id="canvas-container">
                <!-- Konva Stage will be attached here -->
            </div>


        </div>

        <!-- Hardware List View -->
        <div class="absolute inset-x-0 top-16 bottom-0 bg-white overflow-auto hidden" id="hardware-list-view">
            <div class="p-8 max-w-7xl mx-auto">
                <h1 class="text-3xl font-bold text-black mb-6">H/W List</h1>

                <!-- Local Table -->
                <div class="mb-8">
                    <div class="flex justify-end mb-2">
                        <button id="btn-copy-local"
                            class="px-3 py-1.5 text-xs rounded-md bg-slate-100 hover:bg-slate-200 text-slate-700 transition-all flex items-center gap-2">
                            <i data-lucide="copy" class="w-3 h-3"></i>
                            Copy Table
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table id="hardware-list-table-local" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-black text-white">
                                    <th colspan="5" class="px-4 py-2 text-center text-lg"
                                        id="hardware-list-title-local">
                                        <!-- <span id="project-name-local" contenteditable="true"
                                            class="inline-block min-w-[200px] outline-none focus:bg-gray-800 focus:px-2 focus:rounded"
                                            style="cursor: text;">The First Look 2026</span> --> Local
                                    </th>
                                </tr>
                                <tr class="bg-sky-50 text-black">
                                    <th class="border border-gray-300 px-4 py-2 text-center font-bold">Hardware</th>
                                    <th class="border border-gray-300 px-4 py-2 text-center font-bold">Model</th>
                                    <th class="border border-gray-300 px-4 py-2 text-center font-bold">EA</th>
                                    <th class="border border-gray-300 px-4 py-2 text-center font-semibold">R&R</th>
                                    <th class="border border-gray-300 px-4 py-2 text-center font-semibold">Remark</th>
                                </tr>
                            </thead>
                            <tbody id="hardware-list-tbody-local">
                                <!-- Rows will be generated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- I M FINE Table -->
                    <div class="mt-12">
                        <div class="flex justify-end mb-2">
                            <button id="btn-copy-imfine"
                                class="px-3 py-1.5 text-xs rounded-md bg-slate-100 hover:bg-slate-200 text-slate-700 transition-all flex items-center gap-2">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                                Copy Table
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table id="hardware-list-table-imfine" class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-black text-white">
                                        <th colspan="5" class="px-4 py-2 text-center text-lg"
                                            id="hardware-list-title-imfine">
                                            <!-- <span id="project-name-imfine" contenteditable="true"
                                                class="inline-block min-w-[200px] outline-none focus:bg-gray-800 focus:px-2 focus:rounded"
                                                style="cursor: text;">The First Look 2026</span> --> I M Fine
                                        </th>
                                    </tr>
                                    <tr class="bg-red-100 text-black">
                                        <th class="border border-gray-300 px-4 py-2 text-center font-bold">Hardware</th>
                                        <th class="border border-gray-300 px-4 py-2 text-center font-bold">Model</th>
                                        <th class="border border-gray-300 px-4 py-2 text-center font-bold">EA</th>
                                        <th class="border border-gray-300 px-4 py-2 text-center font-semibold">R&R</th>
                                        <th class="border border-gray-300 px-4 py-2 text-center font-semibold">Remark
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="hardware-list-tbody-imfine">
                                    <!-- Rows will be generated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


    </main>

    <!-- Hardware Add/Edit Modal -->
    <div id="hardware-modal"
        class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-80 shadow-2xl transform transition-all scale-100">
            <h3 id="modal-title" class="text-lg font-bold text-slate-900 mb-4">Add Hardware</h3>
            <input type="hidden" id="hw-edit-id"> <!-- Hidden ID for editing -->
            <div class="space-y-3">
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-1">Category</label>
                    <select id="hw-category"
                        class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-900">
                        <option value="Device">Device</option>
                        <option value="Cable">Cable</option>
                        <option value="Infra">Infra</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-1">Type</label>
                    <input type="text" id="hw-type"
                        class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-900"
                        placeholder="e.g. Router, Switch, Cable">
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-1">Model Name</label>
                    <input type="text" id="hw-model"
                        class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-900"
                        placeholder="e.g. CISCO-2960">
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-1">Color</label>
                    <div class="flex items-center gap-2">
                        <input type="color" id="hw-color"
                            class="h-8 w-14 bg-white border border-slate-200 rounded cursor-pointer" value="#3b82f6">
                        <span class="text-xs text-slate-400">Select color</span>
                    </div>
                </div>
            </div>
            <div class="flex gap-2 mt-6">
                <button id="btn-cancel-hw"
                    class="flex-1 bg-slate-100 text-slate-600 py-2 rounded-lg text-sm font-medium hover:bg-slate-200">Cancel</button>
                <button id="btn-save-hw"
                    class="flex-1 bg-slate-900 text-white py-2 rounded-lg text-sm font-medium hover:bg-slate-800">Save</button>
            </div>
        </div>
    </div>

    <!-- Image Upload Modal (Drag & Drop) -->
    <div id="upload-modal"
        class="hidden fixed inset-0 bg-black/50 z-[100] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-2xl shadow-2xl transform transition-all scale-100"
            onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold text-slate-900 mb-4">Upload Floor Plan</h3>
            <div id="drop-zone"
                class="border-2 border-dashed border-slate-300 rounded-xl p-12 text-center hover:border-slate-400 transition-colors cursor-pointer bg-slate-50 hover:bg-slate-100">
                <div class="flex flex-col items-center gap-4">
                    <i data-lucide="upload-cloud" class="w-16 h-16 text-slate-400"></i>
                    <div>
                        <p class="text-slate-700 font-medium mb-1">Drag and drop your image here</p>
                        <p class="text-sm text-slate-500">or</p>
                    </div>
                    <button id="btn-browse-file"
                        class="px-6 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 transition-all">
                        Browse Files
                    </button>
                    <p class="text-xs text-slate-400 mt-2">Supports: JPG, PNG, GIF</p>
                </div>
            </div>
            <div class="flex gap-2 justify-end mt-6 pt-4 border-t border-slate-200">
                <button id="btn-cancel-upload"
                    class="px-4 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm font-medium hover:bg-slate-200 transition-all">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Image Crop Modal -->
    <div id="crop-modal"
        class="hidden fixed inset-0 bg-black/50 z-[100] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-5xl shadow-2xl transform transition-all scale-100 max-h-[90vh] flex flex-col"
            onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold text-slate-900 mb-4">Crop Image</h3>
            <div class="mb-4 flex-1 overflow-auto flex items-center justify-center">
                <img id="crop-image" src="" alt="Crop me"
                    style="max-width: 100%; max-height: calc(90vh - 200px); display: block;">
            </div>
            <div class="mb-4 flex items-center gap-2">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="crop-grayscale"
                        class="w-4 h-4 text-slate-900 border-slate-300 rounded focus:ring-slate-500">
                    <span class="text-sm text-slate-700">Convert to grayscale</span>
                </label>
            </div>
            <div class="flex gap-2 justify-end pt-4 border-t border-slate-200">
                <button id="btn-cancel-crop"
                    class="px-4 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm font-medium hover:bg-slate-200 transition-all">Cancel</button>
                <button id="btn-confirm-crop"
                    class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 transition-all">Confirm</button>
            </div>
        </div>
    </div>

    <!-- NAS Login Modal -->
    <div id="nas-login-modal"
        class="hidden fixed inset-0 bg-black/50 z-[100] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl transform transition-all scale-100"
            onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold text-slate-900 mb-4">NAS 로그인</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">사용자명</label>
                    <input type="text" id="nas-username-input"
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent"
                        placeholder="NAS 사용자명을 입력하세요">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">비밀번호</label>
                    <input type="password" id="nas-password-input"
                        class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent"
                        placeholder="NAS 비밀번호를 입력하세요">
                </div>
            </div>
            <div class="flex gap-2 justify-end mt-6 pt-4 border-t border-slate-200">
                <button id="btn-cancel-nas-login"
                    class="px-4 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm font-medium hover:bg-slate-200 transition-all">취소</button>
                <button id="btn-confirm-nas-login"
                    class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 transition-all">로그인</button>
            </div>
        </div>
    </div>

    <!-- Entry Point -->
    <script type="module">
        // Load version and set it in the UI
        import { APP_VERSION } from './src/config/version.js';
        document.getElementById('app-version').textContent = `v${APP_VERSION}`;
    </script>
    <script type="module" src="./src/main.js"></script>
    <script>
        // Initialize Lucide Icons after load
        window.addEventListener('load', () => {
            lucide.createIcons();
        });
    </script>
</body>

</html>